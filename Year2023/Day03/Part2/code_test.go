package y2023d03p02

import (
	"slices"
	"testing"
)

func TestParseGrid(t *testing.T) {
	tests := []struct {
		name  string
		input string
		want  [][]string
	}{
		{
			name:  "Example Grid",
			input: "467..114..\n...*......\n..35..633.\n......#...\n617*......\n.....+.58.\n..592.....\n......755.\n...$.*....\n.664.598..",
			want: [][]string{
				{"4", "6", "7", ".", ".", "1", "1", "4", ".", "."},
				{".", ".", ".", "*", ".", ".", ".", ".", ".", "."},
				{".", ".", "3", "5", ".", ".", "6", "3", "3", "."},
				{".", ".", ".", ".", ".", ".", "#", ".", ".", "."},
				{"6", "1", "7", "*", ".", ".", ".", ".", ".", "."},
				{".", ".", ".", ".", ".", "+", ".", "5", "8", "."},
				{".", ".", "5", "9", "2", ".", ".", ".", ".", "."},
				{".", ".", ".", ".", ".", ".", "7", "5", "5", "."},
				{".", ".", ".", "$", ".", "*", ".", ".", ".", "."},
				{".", "6", "6", "4", ".", "5", "9", "8", ".", "."},
			},
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := parseGrid(tt.input)

			if len(result) != len(tt.want) {
				t.Fatalf(`Incorrect number of rows. Received %d, expected %d`, len(result), len(tt.want))
			}

			for x := range result {
				if len(result[x]) != len(tt.want[x]) {
					t.Fatalf(`Incorrect number of columns in row %d. Received %d, expected %d`, x, len(result[x]), len(tt.want[x]))
				}

				for y := range result[x] {
					if result[x][y] != tt.want[x][y] {
						t.Fatalf(`Incorrect value in row %d, column %d. Recevied %v, expected %v`, x, y, result[x][y], tt.want[x][y])
					}
				}
			}
		})
	}

}

func TestFindPartNumbers(t *testing.T) {
	tests := []struct {
		name  string
		input [][]string
		want  []int
	}{
		{
			name: "Example Grid",
			input: [][]string{
				{"4", "6", "7", ".", ".", "1", "1", "4", ".", "."},
				{".", ".", ".", "*", ".", ".", ".", ".", ".", "."},
				{".", ".", "3", "5", ".", ".", "6", "3", "3", "."},
				{".", ".", ".", ".", ".", ".", "#", ".", ".", "."},
				{"6", "1", "7", "*", ".", ".", ".", ".", ".", "."},
				{".", ".", ".", ".", ".", "+", ".", "5", "8", "."},
				{".", ".", "5", "9", "2", ".", ".", ".", ".", "."},
				{".", ".", ".", ".", ".", ".", "7", "5", "5", "."},
				{".", ".", ".", "$", ".", "*", ".", ".", ".", "."},
				{".", "6", "6", "4", ".", "5", "9", "8", ".", "."},
			},
			want: []int{467 * 35, 755 * 598},
		},
		{
			name: "Mini Grid E+W",
			input: [][]string{
				{".", ".", "."},
				{"3", "*", "4"},
				{".", ".", "."},
			},
			want: []int{3 * 4},
		},
		{
			name: "Midi Grid E+W",
			input: [][]string{
				{".", ".", ".", ".", "."},
				{"1", "2", "*", "3", "4"},
				{".", ".", ".", ".", "."},
			},
			want: []int{12 * 34},
		},
		{
			name: "Mini Grid N+S discrete",
			input: [][]string{
				{"1", ".", "2"},
				{".", "*", "."},
				{"3", ".", "4"},
			},
			want: []int{},
		}, {
			name: "Midi Grid N+S discrete",
			input: [][]string{
				{"1", "2", ".", "3", "4"},
				{".", ".", "*", ".", "."},
				{"5", "6", ".", "7", "8"},
			},
			want: []int{},
		},
		{
			name: "Mini Grid N+S joined",
			input: [][]string{
				{"1", "2", "3"},
				{".", "*", "."},
				{"4", "5", "6"},
			},
			want: []int{123 * 456},
		},
		{
			name: "Midi Grid N+S joined",
			input: [][]string{
				{"1", "2", "3", "4", "5"},
				{".", ".", "*", ".", "."},
				{"6", "7", "8", "9", "0"},
			},
			want: []int{12345 * 67890},
		},
		{
			name: "Mini Grid Corner Symbol",
			input: [][]string{
				{".", ".", "*"},
				{"1", "2", "3"},
				{"*", ".", "."},
			},
			want: []int{},
		},
		{
			name: "Mini Grid Corner Symbol 2",
			input: [][]string{
				{"*", ".", "."},
				{"1", "2", "3"},
				{".", ".", "*"},
			},
			want: []int{},
		},
		{
			name: "Mini Grid Corner Symbol 3",
			input: [][]string{
				{"1", "2", "*"},
				{".", "3", "4"},
				{".", ".", "."},
			},
			want: []int{12 * 34},
		},
		{
			name: "Mini Grid Corner Symbol 4",
			input: [][]string{
				{".", ".", "."},
				{"1", "2", "."},
				{"*", "3", "4"},
			},
			want: []int{34 * 12},
		}, {
			name: "Handle leading zero",
			input: [][]string{
				{"1", "0", "2", "0", "3"},
				{".", ".", "*", ".", "."},
				{"4", "0", "5", "0", "6"},
			},
			want: []int{10203 * 40506},
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := findGearRatios(tt.input)

			if !slices.Equal(result, tt.want) {
				t.Fatalf("Receieved %v, expected %v", result, tt.want)
			}
		})
	}

}

func TestCalculateExample(t *testing.T) {
	tests := []struct {
		name  string
		input string
		want  int
	}{
		{
			name:  "Example Grid",
			input: "467..114..\n...*......\n..35..633.\n......#...\n617*......\n.....+.58.\n..592.....\n......755.\n...$.*....\n.664.598..",
			want:  467835,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := Calculate(tt.input)

			if result != tt.want {
				t.Fatalf("Receieved %d, expected %d", result, tt.want)
			}
		})
	}

}

func TestCalculateInput(t *testing.T) {
	tests := []struct {
		name  string
		input string
		want  int
	}{
		{
			name:  "Input Grid",
			input: ".......................661.........................485..565.......344.......325.....................................841.....725.............\n....*609..131................512.......................*................536*..............462/..-...60..424.........@....$.*................\n.316.........*.......39..................@.630......377........919...........98................789..*..*..............788..2.......=..564...\n...........431...535...*...............622.-..../.................*..........*.......682...........108.116....@...-...............299.......\n.....................428.....378...844.........416...............586.537=..27..........*......$..............871...331..................492.\n...878....390....%..............*.*...................739.496=.................867......867..867.........................344......487.../...\n...../.....*...558........@..535...644..................+.........404..605.......*................................%.....*...................\n........................381............729..726....578........10...*..........818..............................929....934..........119......\n.53....31..........734-..........847*.................#.........*...........#............217............/..321....................*.........\n.......=.............................509.315.654.................60.........925.747*559..*.....430....226..*...................290...848=...\n..........=.......546......664..507......../....#.......337.............................94........=.........359....528*996..................\n.....351...638.......*.............*433............337.....................226...859........../............................378..............\n.......*..........648.........183.........126........*...........208.954......=....*.......626........499*..........803.../....642.235......\n.518*...813..990..............*..............*......699...133....+...............68...............79......838.447...*..........*...*........\n................+.696*.........586.6......243.............*..........$224.............392...275.....-.........*...699...#177..230.593.&.....\n...........$326.......683.-761.......491......./.........26...........................*.....=.........56.305.262.......................150..\n....=.......................................41.908.........................819.785.....276.....&.................%..........................\n.618......401$...............-......................599..124......34+.........*..............676..................342...........473.........\n....................889......888..454....723/.........*.................141*.....958.......................................416.....*94......\n....212.............-................%.........826=....552..................569....*............................728........=............143.\n...*......287...................=60.............................872.....886.......171....437......815..680.........*.............633....+...\n..234....*.....687..........432........203/.....*...275.65.........*341.@...........................*....%.246......272.....922*..../.......\n........967.........495.......*....161.......474.97...*..*..84.400.........*295....805......................@...................915.........\n...419.................*.979...932....*.............729.215.#....*.......81........*......554.263*567..........812..........................\n.....*..............458....$.........682......................179................348..906.................428.../............798............\n...668..................-.........................552............./..................=.......+...........@..........99........*..85.4.......\n........29......938..594......107........*171.98.....*..896....$..491...........+..........412..12.............326.*.....705..4....*........\n..........*....................+......332......@....949..*...750.......$..974....342.............*....558......#............*..........794..\n.......459....342*.........637...........................273.....658..601....*................735....*...............%....627....889...*....\n.697..............131....................718.................689.............450....390............994.............793.............*..241...\n..............991........89..........14.......*.................*912.............39.+...698.............................953*240...87........\n..324.............618.....*...328......*....538.%.....307.920.........515...............*...................................................\n.....*386...........*...780..*.......475.........719...*...*...................910...410................384.....999........*756.............\n....................268.......701.............72........63.43...193.....+..................674...670$....*........*......95.......893.......\n...16.........................................*....663........../....407.....................*........258....264=.298........202*..../......\n...&......574................187.......88...53.........931........@......&759....$..672....385..............................................\n.....938........192......297....*.723...*.................%......930...........692................283.....................=349.........&981.\n......*....................&.207....*...843.736.........................260..........677..389........*..............954..........&..........\n......603........713.............745..................411.359.922.......*.............*......*.......718..888..561..=.........182..206......\n............896....*.....173*383.......%...145...943...*.....*.........622..382*.......180.141............*...........................*.....\n.....89........*...238.............+.714....*........575../.........................@...............$.....539.......114*721.645........471..\n.......*307....968..............250......836.....498......59....909..601*..........117...........435../........944..........................\n............*...............56*.................+....498..........-......730.882..........975..........680........*...95......152....$517...\n...........150.......142.......473.713.+262...........=...577.266...736..........668..$.........70*111......811.165..@......................\n.......741.............*.97.......................=.........*.......*....-654..........428..157................................748*823......\n.........*............48...*.....772....892.....350....$.....760.148.............................440...........731*563......................\n........260..............227...............*..........795..................649.....27.107...219.@.....23@...............226......369........\n...41............&...................+...136.....546.......$.920...................+...*...&....../.........981...........@.......*.....454.\n...*......635%....782...............560............*....896...........854..+...........694......340...@.498*....................41..959*....\n...486..........................63..................810......641....+....*..532....642.......$.......90.....................76=.............\n..........325.....................@..............@...........-....539.407.............$......9...........550................................\n...787..$....*.$105.126.+810.........497.576...538.............................718.......................*...+....317..519..................\n.......303.493...........................................-...........462..647..*...........%..+875....641..644.....*......*.....154.588.....\n................./.....-......44.........%...@140.......228...43......*....*..132.794...628.......................669....110....*.....*.....\n....579...........348..32.491*.......#...646.......506..........*708......74........#........117..............24*............698....532.....\n......*.........................902.722............=....=........................................700....610......878....*...................\n.../..885.../..351.............*.........................799.....814*238......*339....428*825......./................965.862......125.......\n.723......243.@........852..........757...784.472..814.......603...........151........................279.617....849........................\n........................*......./............*.......*.........*....#.............91.......246...384.....*........%.........................\n.218.659....113+........128....691...................972......571....934............*......*...................................442..236.....\n....*...............455.............868......&379.........................594.......80....654.....................421.456...................\n............2*535......*410...553........409......235.173..779......116.....*.................&........*646.418*.....*.................596..\n.70#.361......................./....493....$..........*...-.....440.........317...865...323....696..202..........952.......187.....%....#...\n..........%...767......318............*................1.............../...........*......*................241......@.147...*.....389.......\n..921.....301..*........*............67.540.../....149.........=........827.....=.347....956..........980...............$...204.............\n...*............341......154.............*..695.....$.....20.183..............177..................$...$...66......699..........495......296\n.460........&.......+............%.......4......+........*.......................................347.........*36...*....912.......*..765....\n............142..163......885..480...............805.%...587...........289.310*389........$843..........-..........417....*.....628....*....\n.............................*............434........803........482......-.........556.........&.........294...33$.........79........358....\n.......................407@...873...............+..................*542....../.41....$./758....176.................*........................\n.........842......................442*766.......284.........842...........856...*......................647......422.94..............@.......\n....$........799............................&.......433.318*.....576..........111....................................................788....\n.720...168.....%........840..............989....................*.......=............468..419...........198.................................\n......*..................+..392..............282.......&...............591..........&....*....101.340....-.....187.....-....................\n.....746...........................499...779...*....456...........@....................346....*......%...........*..693.......94..72........\n.........970..671..696./....................&..999......124..246.434...........................173........@.....165.......925*.../..........\n..628.............*....608.....827-.......*..............#....*........634...../418......185.......311...808.........372*............824....\n..........694...360.....................43.645.................935........*516...........*....555.....*..................33.........-.......\n............*............+........576#.........810*592..740.....................#665..968........*499.775..882+..............998............\n....=303.....433.280......147..82.........................*..............................................................751*...............\n.................$......................608...560..827...227....................448*..@......................@529.376...........@...........\n...........465.....#.............554.....#.......#..#.......................401.......714...../.192.999..................466...28.161....351\n..............&....706..157.679.@..........741..............818.811=..............412.......376...&..*.......=..............................\n.441.....955....63.........*........=........+.............*..............#..........*..............399.......613.......444........*972.....\n........@......*..................697..........600.&965...354.#.....392...827..665....326.................323...........&.......483.........\n................381........972..........373*..*................9...&...........................289.........*................................\n...........................*....+.............239......................863....................*..........341.....*329...................$...\n801..+...638.659........358...29..695.....@........241...680.....863..........................310.#...........941........@216........311....\n...*.358.*...*....................@....786....*330................&.........842........11..........279...................................686\n.932..........666....533..712..............801.............64.544.....*972.....*353....-..809...........524...........397...............*...\n.........795+.......*.......*......394=................586......*.........................................&...........................562...\n...................629.......184........796..............=................-946.348.../670............63.........%...........................\n.....428-................918.........@..............#.............850.889.........*..............673..#..110.221..........337.560...-.......\n.....................926*.........809.........=......627.............*..........344..........343.*........*.......832.......*....*...216....\n.....624.....+................................78............915..701.....876.........734.402.....181.193.460.639.....*...558...138..........\n.../...*...91....804..324..985......#429......................*..*.............892....................*......*...321.727...........134......\n...991............*.........*.............39...........%.633.213.623..........&...........601.919.....378.318...*............@34............\n........183.....#.399...+..297..973...622..*........855../......................+684../......*................335.................733.......\n..........@..576......597........*.....*....686....................371..98..23$......119................................=.777......*........\n.................901%......*...412......102...........754...332.47*......*......861+......539................495@....801...*..404...777.....\n.........577..........577..978.................990......*...#............236.............@..............339............../......*........534\n..169.....*..687........*..........598..........*..349@.723.....864..........972............196.....491*........$........335.372............\n.........339..=......633........29...*.........4............251*.....$..........*.250.........$.908..............356.230...........324.386..\n.................943.............-.....=............................325...726.690.*................/.......646........*...214.......=.......\n.........&468.......*..................999.......944.........751..........*.......219.837.107..............*...=....271..*..............283.\n......*..........210.....*390.....917*.....996*.....+..790...-.........128...............*................905.277.......320....936..835.....\n...640.581....*.......167.............392......29......*..........885............................369..................&...........*.$...#...\n..............708..........106.223...................817.........*............277.........&.........@..795.-296....172..........633......229\n.......82..........@679.......*....*806.................../....10.............*.........456...........*.................95...........3......\n..........536....................12........=914..458.......214..........995..97.-735........370.......334..876=.........*.......950#........\n.........*.............=.....10.......837...........+..518.................*...................*........................761.................\n......414..=.........794.............=................*...................813.394...815.718....759........403...............738.............\n............463...........-..238.419............810.41...........452..2=..................&..............&........435.................468...\n........................103....*..........................+...11.&....................927...........%.......282...*...234.....229......*....\n......301+....................678............100.......954.....*...@....182....@.........*....737...916....-....890....@..118*.......625....\n............67...312..865+.............910.....*...382.......516....973....*..874.500..153.....*............................................\n.....373+...*.....*...............979..........469....*375..............765...................99....................733................897..\n..........828.....669......=.....*...........................................284.189...$..371......*168..............%.......762............\n..........................4..565.226........562@....190......281....257.......*.......889./......57........./...#.......210..*..............\n......47.......120.............#...................*...........&....*.....169.549............%............414..744......%....503.#208.......\n........*.................643.........397...........350..........289....&...*........&.....323.....+..................................856...\n.....*...............458....#........................................104.....931..855..............89..469.....882...........=.........*....\n..594.777......390...*...........422........355..............654............................81........*...........*......282..630....195....\n..................*.568.912........*........*.....377..........*......*877.............419..*.....148.768.......471....+....*...............\n.......393......163..........298.820............@..................582.......823......=...........*....................952..................\n..........*268.......*733.59...@.............403..........................................14&...502...............481.........$.....231.....\n........#.........970.....*......#....981...........711.261=.................=.......................701..244................323.....*......\n.396....993.............557.......46.....*...........+..........714*659.....134........623..........*............677.730..............846...\n......#......91...405........296..........295..............@..*.......................#..............740............*........%..............\n.......345..=........-.792....*..834................100.891....764...697........570......*....620*.@.....................508..295...........\n...*13................../...340...#..134..............#................*..........*.......247......660....607....705.....=...........165....\n.........521..824...222.............*......372..290.....844.825-.......867..820...627...........................*............128...../...777\n...629...*....#..................788...535....*..-.......*.........361......................*......805.......732....914....../...-......@...\n...*.....743...........853..................637.......880...-..849*........425............946..590....*302...........*.........748..........\n...120.%.......271..............862.....70................207................=......233.......*..................443..263...................\n........680....../.825.....&793...........*....................-720.............555........184..509.......22......*.............811.........\n..........................................772.272......................134.........*..374.........*............573........*.......*.........\n934..231.....*....821...230.....981..............%........707..370....*.....634%..787..*..........93..909..70..........199.59...490.........\n.......*....525.........-........*...747...676=..../.......*..........829...............324..952.........%...*..........................%...\n.....189.........................791.............236........687.868........................................505..............713......777....",
			want:  74528807,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result := Calculate(tt.input)

			if result != tt.want {
				t.Fatalf("Receieved %d, expected %d", result, tt.want)
			}
		})
	}

}
